var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,i){var t=this,a=arguments,s=function(){e.type="debouncedresize",$event.dispatch.apply(t,a)};resizeTimeout&&clearTimeout(resizeTimeout),i?s():resizeTimeout=setTimeout(s,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(e){function i(){var i=$(o),t=$(l);s&&(l.length?s.reject(r,i,t):s.resolve(r)),$.isFunction(e)&&e.call(a,r,i,t)}function t(e,t){e.src!==BLANK&&-1===$.inArray(e,h)&&(h.push(e),t?l.push(e):o.push(e),$.data(e,"imagesLoaded",{isBroken:t,src:e.src}),n&&s.notifyWith($(e),[t,r,$(o),$(l)]),r.length===h.length&&(setTimeout(i),r.unbind(".imagesLoaded")))}var a=this,s=$.isFunction($.Deferred)?$.Deferred():0,n=$.isFunction(s.notify),r=a.find("img").add(a.filter("img")),h=[],o=[],l=[];return $.isPlainObject(e)&&$.each(e,function(i,t){"callback"===i?e=t:s&&s[i](t)}),r.length?r.bind("load.imagesLoaded error.imagesLoaded",function(e){t(e.target,"error"===e.type)}).each(function(e,i){var a=i.src,s=$.data(i,"imagesLoaded");return s&&s.src===a?void t(i,s.isBroken):i.complete&&void 0!==i.naturalWidth?void t(i,0===i.naturalWidth||0===i.naturalHeight):void((i.readyState||i.complete)&&(i.src=BLANK,i.src=a))}):i(),s?s.promise(a):a};var Grid=function(){function e(e){I=$.extend(!0,{},I,e),l.imagesLoaded(function(){t(!0),n(),a()})}function i(e){d=d.add(e),e.each(function(){var e=$(this);e.data({offsetTop:e.offset().top,height:e.height()})}),s(e)}function t(e){d.each(function(){var i=$(this);i.data("offsetTop",i.offset().top),e&&i.data("height",i.height())})}function a(){s(d),p.on("debouncedresize",function(){u=0,m=-1,t(),n();var e=$.data(this,"preview");"undefined"!=typeof e&&h()})}function s(e){e.on("click","span.og-close",function(){return h(),!1}).children("a").on("click",function(){var e=$(this).parent();return c===e.index()?h():r(e),!1})}function n(){f={width:p.width(),height:p.height()}}function r(e){var i=$.data(this,"preview"),t=e.data("offsetTop");if(u=0,"undefined"!=typeof i){if(m===t)return i.update(e),!1;t>m&&(u=i.height),h()}m=t,i=$.data(this,"preview",new o(e)),i.open()}function h(){c=-1;var e=$.data(this,"preview");e.close(),$.removeData(this,"preview")}function o(e){this.$item=e,this.expandedIdx=this.$item.index(),this.create(),this.update()}var l=$("#og-grid"),d=l.children("li"),c=-1,m=-1,u=0,g=10,p=$(window),f,v=$("html, body"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},w=b[Modernizr.prefixed("transition")],T=Modernizr.csstransitions,I={minHeight:500,speed:350,easing:"ease"};return o.prototype={create:function(){this.$iframeWrapper=$('<iframe src="" frameborder="0" allowfullscreen></iframe>'),this.$fullSizeImg=$('<img src="" alt="" />'),this.$fullSizeImgContainer=$('<div class="og-fullimg"></div>').append(this.$fullSizeImg,this.$loading,this.$iframeWrapper),this.$thumbnailSrcOne=$('<img class="thumb" rel="" src="">'),this.$thumbnailSrcTwo=$('<img class="thumb" rel="" src="">'),this.$thumbnailSrcThree=$('<img class="thumb" rel="" src="">'),this.$smallThumbContainerOne=$('<a class="SmallImage" href="#"></a>').append(this.$thumbnailSrcOne),this.$smallThumbContainerTwo=$('<a class="SmallImage" href="#"></a>').append(this.$thumbnailSrcTwo),this.$smallThumbContainerThree=$('<a class="SmallImage" href="#"></a>').append(this.$thumbnailSrcThree),this.$largePreviewImageContainer=$('<div class="LargePreviewImageContainer"></div>').append(this.$fullSizeImgContainer),this.$smallPreviewContainer=$('<div class="SmallPreviewImageContainer"></div>').append(this.$smallThumbContainerOne,this.$smallThumbContainerTwo,this.$smallThumbContainerThree),this.$previewLargeContainer=$('<div class="PreviewImageContainer"> </div>').append(this.$largePreviewImageContainer,this.$smallPreviewContainer),this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="http://www.scriptedpixels.co.uk">Visit website</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$previewLargeContainer,this.$closePreview,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),T&&this.setTransition()},update:function(e){if(e&&(this.$item=e),-1!==c){var i=d.eq(c);i.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}c=this.$item.index();var t=this.$item.children("a"),a={href:t.attr("href"),largesrc:t.data("largesrc"),title:t.data("title"),description:t.data("description"),price:t.data("price"),thumb1:t.data("thumb-1"),thumb2:t.data("thumb-2"),thumb3:t.data("thumb-3"),video:t.data("video")};this.$title.html(a.title),this.$description.html(a.description),this.$href.attr("href",a.href),this.$thumbnailSrcOne.attr("src",a.thumb1?a.thumb1:""),this.$smallThumbContainerOne.attr("rel",a.thumb1?a.thumb1:""),this.$thumbnailSrcTwo.attr("src",a.thumb2?a.thumb2:""),this.$smallThumbContainerTwo.attr("rel",a.thumb2?a.thumb2:""),this.$thumbnailSrcThree.attr("src",a.thumb3?a.thumb3:""),this.$smallThumbContainerThree.attr("rel",a.thumb3?a.thumb3:""),a.video?this.$iframeWrapper.attr("src",a.video?a.video:"").css("display","block"):this.$iframeWrapper.css("display","none");var s=this;"undefined"!=typeof s.$largeImg&&s.$largeImg.remove(),s.$fullSizeImgContainer.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var e=$(this);e.attr("src")===s.$item.children("a").data("largesrc")&&(s.$loading.hide(),s.$fullSizeImgContainer.find("img").remove(),s.$largeImg=e.fadeIn(350),s.$fullSizeImgContainer.append(s.$largeImg))}).attr("src",a.largesrc)),this.PreviewGallery()},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var e=this,i=function(){T&&$(this).off(w),e.$item.removeClass("og-expanded"),e.$previewEl.remove()};return setTimeout($.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var e=d.eq(this.expandedIdx);e.css("height",e.data("height")).on(w,i),T||i.call()},this),25),!1},calcHeight:function(){var e=f.height-this.$item.data("height")-g,i=f.height;e<I.minHeight&&(e=I.minHeight,i=I.minHeight+this.$item.data("height")+g),this.height=e,this.itemHeight=i},setHeights:function(){var e=this,i=function(){T&&e.$item.off(w),e.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(w,i),T||i.call()},positionPreview:function(){var e=this.$item.data("offsetTop"),i=this.$previewEl.offset().top-u,t=this.height+this.$item.data("height")+g<=f.height?e:this.height<f.height?i-(f.height-this.height):i;v.animate({scrollTop:t},I.speed)},setTransition:function(){this.$previewEl.css("transition","height "+I.speed+"ms "+I.easing),this.$item.css("transition","height "+I.speed+"ms "+I.easing)},getEl:function(){return this.$previewEl},PreviewGallery:function(){$(".SmallImage").click(function(){var e=$(this).attr("rel");return $(".og-fullimg").hide(),$(".og-fullimg").html('<img src="'+e+'"/>'),$(".og-fullimg").fadeIn("slow"),!1})}},{init:e,addItems:i}}();